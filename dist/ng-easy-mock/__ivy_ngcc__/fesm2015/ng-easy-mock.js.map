{"version":3,"file":"ng-easy-mock.js","sources":["../../../projects/ng-easy-mock/src/lib/interfaces.ts","../../../projects/ng-easy-mock/src/lib/ng-easy-mock.service.ts","../../../projects/ng-easy-mock/src/lib/ng-easy-mock.interceptor.ts","../../../projects/ng-easy-mock/src/lib/ng-easy-mock.module.ts","../../../projects/ng-easy-mock/src/public-api.ts","../../../projects/ng-easy-mock/src/ng-easy-mock.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\r\nimport { HttpResponse, HttpRequest } from '@angular/common/http';\r\n\r\n/**\r\n * Ê®°ÊãüHTTPÈîôËØØÁä∂ÊÄÅÁ±ª\r\n */\r\nexport class MockStatusError {\r\n    constructor(status: number = 500) {\r\n        return new HttpResponse({ status, statusText: 'HTTPÂºÇÂ∏∏' });\r\n    }\r\n}\r\n\r\n/**\r\n * MockËØ∑Ê±ÇÂØπË±° \r\n */\r\nexport interface MockRequest {\r\n    params: { [key: string]: string },\r\n    queryString: { [key: string]: string },\r\n    headers: { [key: string]: string },\r\n    body: any,\r\n    original: HttpRequest<any>\r\n}\r\n\r\n/**\r\n * mock ÈÖçÁΩÆ\r\n */\r\nexport interface MockConfig {\r\n    delay?: number,\r\n    log?: boolean,\r\n    data: { [key: string]: { [key: string]: any } }\r\n}\r\n\r\n/**\r\n * ËßÑÂàôÂØπË±°(ÂÜÖÈÉ®‰ΩøÁî®)\r\n */\r\nexport interface rule {\r\n    method: string,\r\n    url: string,\r\n    data: any\r\n}\r\n\r\n/**\r\n * ÈÖçÁΩÆÊ≥®ÂÖ•‰ª§Áâå(ÂÜÖÈÉ®‰ΩøÁî®)\r\n */\r\nexport const Config = new InjectionToken<MockConfig>('config');\r\n\r\n","import { Injectable, Optional, Inject } from '@angular/core';\r\n\r\nimport { MockConfig, Config, rule } from './interfaces';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgEasyMockService {\r\n\r\n  ruleList: rule[] = [];\r\n\r\n  constructor(@Optional() @Inject(Config) public config: MockConfig) {\r\n    this.config = Object.assign({ delay: 300, log: true }, this.config);\r\n\r\n    Object.values(this.config.data || {}).forEach(obj => {\r\n      Object.entries(obj).forEach(([key, value]) => {\r\n        if (!key.includes(' ')) {\r\n          key = `GET ${key}`;\r\n        }\r\n        let ruleUrls = key.split(' ');\r\n        this.ruleList.push({\r\n          method: ruleUrls[0].toLocaleUpperCase(),\r\n          url: ruleUrls[1],\r\n          data: value\r\n        });\r\n      });\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñËßÑÂàô\r\n   * @param method \r\n   * @param url \r\n   */\r\n  getRule(method: string, url: string) {\r\n    method = method.toLocaleUpperCase();\r\n    url = this.getPath(url);\r\n\r\n    return this.ruleList.filter(item => item.method == method).find(item => {\r\n      let urlSegmentList = this.getUrlSegment(url);\r\n      let ruleSegmentList = this.getUrlSegment(item.url);\r\n      if (urlSegmentList.length == ruleSegmentList.length) {\r\n        return ruleSegmentList.every((ruleUrlSegment, index) => {\r\n          if(ruleUrlSegment.startsWith(':')) return true;\r\n          return ruleUrlSegment == urlSegmentList[index];\r\n        });\r\n      } else {\r\n        return false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * ÁßªÈô§Êü•ËØ¢Â≠óÁ¨¶‰∏≤\r\n   * @param url \r\n   */\r\n  getPath(url: string) {\r\n    return url.slice(0, url.includes('?') ? url.indexOf('?') : undefined);\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñURLÁâáÊÆµ\r\n   * @param url \r\n   */\r\n  getUrlSegment(url: string) {\r\n    return url.split('/');\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpRequest, HttpHandler, HttpEvent, HttpInterceptor, HttpResponse } from '@angular/common/http';\r\n\r\nimport { Observable, of } from 'rxjs';\r\nimport { delay } from 'rxjs/operators';\r\n\r\nimport { NgEasyMockService } from './ng-easy-mock.service';\r\nimport { rule, MockRequest } from './interfaces';\r\n\r\n@Injectable()\r\nexport class NgEasyMockInterceptor implements HttpInterceptor {\r\n\r\n  constructor(public mockService: NgEasyMockService) { }\r\n\r\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    let rule = this.mockService.getRule(request.method, request.urlWithParams);\r\n    if (!rule) return next.handle(request);\r\n\r\n    let httpResponse = new HttpResponse({\r\n      body: (typeof rule.data == 'function') ? rule.data(this.getParams(request, rule)) : this.clone(rule.data)\r\n    });\r\n\r\n    if (this.mockService.config.log) {\r\n      console.log(`%cüëΩ [${request.method}] -> [${this.mockService.getPath(request.urlWithParams)}] -> [Request]`, 'background:#000;color:#bada55', request);\r\n      console.log(`%cüëΩ [${request.method}] -> [${this.mockService.getPath(request.urlWithParams)}] -> [Response]`, 'background:#000;color:#bada55', httpResponse);\r\n    }\r\n\r\n    return of(httpResponse).pipe(delay(this.mockService.config.delay));\r\n  }\r\n\r\n  /**\r\n   * Ëé∑ÂèñÂèÇÊï∞\r\n   * @param request \r\n   * @param rule \r\n   */\r\n  getParams(request: HttpRequest<any>, rule: rule): MockRequest {\r\n    let mockRequest: MockRequest = {\r\n      params: {},\r\n      queryString: {},\r\n      headers: {},\r\n      body: request.body,\r\n      original: request\r\n    };\r\n\r\n    let urlSegmentList = this.mockService.getUrlSegment(this.mockService.getPath(request.urlWithParams));\r\n    let ruleSegmentList = this.mockService.getUrlSegment(rule.url);\r\n    ruleSegmentList.forEach((ruleUrlSegment, index) => {\r\n      if (ruleUrlSegment.startsWith(':')) {\r\n        mockRequest.params[ruleUrlSegment.slice(1)] = urlSegmentList[index];\r\n      }\r\n    });\r\n\r\n    let queryString = request.urlWithParams.slice(request.urlWithParams.includes('?') ? request.urlWithParams.indexOf('?') + 1 : 0);\r\n    if (queryString) {\r\n      queryString.split('&').forEach(item => {\r\n        let [key, value] = item.split('=');\r\n        mockRequest.queryString[key] = value;\r\n      });\r\n    }\r\n\r\n    request.headers.keys().forEach(key => {\r\n      mockRequest.headers[key] = request.headers.get(key);\r\n    });\r\n\r\n    return mockRequest;\r\n  }\r\n\r\n  /**\r\n   * ÂÖãÈöÜÂØπË±°\r\n   * @param obj \r\n   */\r\n  clone(obj = null) {\r\n    return JSON.parse(JSON.stringify(obj));\r\n  }\r\n\r\n}","import { NgModule, ModuleWithProviders } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\r\n\r\nimport { MockConfig, Config } from './interfaces';\r\nimport { NgEasyMockInterceptor } from './ng-easy-mock.interceptor';\r\n\r\n@NgModule({\r\n  providers: [{ provide: HTTP_INTERCEPTORS, useClass: NgEasyMockInterceptor, multi: true }],\r\n  declarations: [],\r\n  imports: [\r\n    CommonModule\r\n  ]\r\n})\r\nexport class NgEasyMockModule {\r\n  static forRoot(config: MockConfig): ModuleWithProviders<NgEasyMockModule> {\r\n    return {\r\n      ngModule: NgEasyMockModule,\r\n      providers: [{ provide: Config, useValue: config }]\r\n    };\r\n  }\r\n}\r\n","/*\r\n * Public API Surface of ng-easy-mock\r\n */\r\n\r\nexport * from './lib/interfaces';\r\nexport * from './lib/ng-easy-mock.service';\r\nexport * from './lib/ng-easy-mock.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {NgEasyMockInterceptor as …µa} from './lib/ng-easy-mock.interceptor';"]}